<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Cuentas</title>
    <link rel="stylesheet" href="styles.css">
    <script defer src="app.js"></script>
</head>
<body>
    <h1>Sistema de Gestión de Cuentas</h1>
    
    <!-- Panel de Control -->
    <section>
        <h2>Panel de Control</h2>
        <p>Total de Cuentas Activas: <span id="totalActivas">0</span></p>
        <p>Cuentas Caídas: <span id="totalCaidas">0</span></p>
        <p>Perfiles Disponibles: <span id="totalPerfiles">0</span></p>
        <p>Próximos Vencimientos: <span id="proximosVencimientos">0</span></p>
    </section>
    
    <!-- Registro de Cuenta Completa -->
    <section>
        <h2>Registrar Cuenta Completa</h2>
        <form id="registroCuenta">
            <input type="email" id="correo" placeholder="Correo" required>
            <input type="password" id="contraseña" placeholder="Contraseña" required>
            <input type="number" id="perfiles" placeholder="Cantidad de Perfiles" required>
            <input type="date" id="fecha_vencimiento" required>
            <button type="submit">Registrar</button>
        </form>
    </section>
    
    <!-- Asignación de Perfiles -->
    <section>
        <h2>Asignar Perfil</h2>
        <form id="asignarPerfil">
            <select id="cuentasDisponibles"></select>
            <input type="text" id="nombreCliente" placeholder="Nombre del Cliente" required>
            <input type="tel" id="whatsapp" placeholder="WhatsApp del Cliente" required>
            <button type="submit">Asignar</button>
        </form>
        <p id="advertencia" style="color: red; display: none;">⚠️ No hay perfiles disponibles en esta cuenta.</p>
    </section>
    
    <!-- Historial de Movimientos -->
    <section>
        <h2>Historial de Movimientos</h2>
        <ul id="historialMovimientos"></ul>
    </section>
    
    <!-- Notificaciones de Renovación -->
    <section>
        <h2>Notificaciones</h2>
        <button id="enviarNotificaciones">Enviar Notificaciones de Renovación</button>
    </section>
    
    <!-- Reemplazo de Cuentas Caídas -->
    <section>
        <h2>Reemplazo de Cuentas Caídas</h2>
        <form id="reemplazoCuenta">
            <select id="cuentaCaida"></select>
            <input type="email" id="nuevoCorreo" placeholder="Nuevo Correo" required>
            <input type="password" id="nuevaContraseña" placeholder="Nueva Contraseña" required>
            <input type="date" id="nuevaFechaVencimiento" required>
            <button type="submit">Reemplazar Cuenta</button>
        </form>
    </section>
    
    <!-- Lista de Clientes con Búsqueda -->
    <section>
        <h2>Lista de Clientes</h2>
        <input type="text" id="buscarCliente" placeholder="Buscar Cliente...">
        <ul id="listaClientes"></ul>
    </section>
    
    <!-- Exportar Datos -->
    <section>
        <h2>Exportar Datos</h2>
        <button id="exportarExcel">Exportar a Excel</button>
        <button id="exportarPDF">Exportar a PDF</button>
    </section>
    
    <!-- Notas y Comentarios -->
    <section>
        <h2>Notas y Comentarios</h2>
        <textarea id="notaGeneral" placeholder="Agregar nota general..."></textarea>
        <button id="guardarNota">Guardar Nota</button>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const registroCuenta = document.getElementById("registroCuenta");
            const asignarPerfil = document.getElementById("asignarPerfil");
            const reemplazoCuenta = document.getElementById("reemplazoCuenta");
            const listaClientes = document.getElementById("listaClientes");
            const historialMovimientos = document.getElementById("historialMovimientos");
            
            let cuentas = [];
            let clientes = [];

            // Registrar Cuenta
            registroCuenta.addEventListener("submit", function(event) {
                event.preventDefault();
                const correo = document.getElementById("correo").value;
                const contraseña = document.getElementById("contraseña").value;
                const perfiles = parseInt(document.getElementById("perfiles").value);
                const fecha_vencimiento = document.getElementById("fecha_vencimiento").value;

                cuentas.push({ correo, contraseña, perfiles, fecha_vencimiento, ocupados: 0 });
                actualizarCuentasDisponibles();
                alert("Cuenta registrada correctamente");
                registroCuenta.reset();
            });

            // Asignar Perfil
            asignarPerfil.addEventListener("submit", function(event) {
                event.preventDefault();
                const cuentaIndex = document.getElementById("cuentasDisponibles").value;
                const nombreCliente = document.getElementById("nombreCliente").value;
                const whatsapp = document.getElementById("whatsapp").value;

                if (cuentaIndex !== "" && cuentas[cuentaIndex].ocupados < cuentas[cuentaIndex].perfiles) {
                    cuentas[cuentaIndex].ocupados += 1;
                    clientes.push({ nombreCliente, whatsapp, cuenta: cuentas[cuentaIndex].correo });
                    actualizarListaClientes();
                    alert("Perfil asignado correctamente");
                    asignarPerfil.reset();
                } else {
                    document.getElementById("advertencia").style.display = "block";
                }
            });

            // Reemplazo de Cuenta
            reemplazoCuenta.addEventListener("submit", function(event) {
                event.preventDefault();
                const cuentaIndex = document.getElementById("cuentaCaida").value;
                const nuevoCorreo = document.getElementById("nuevoCorreo").value;
                const nuevaContraseña = document.getElementById("nuevaContraseña").value;
                const nuevaFechaVencimiento = document.getElementById("nuevaFechaVencimiento").value;

                cuentas[cuentaIndex] = { correo: nuevoCorreo, contraseña: nuevaContraseña, perfiles: 5, fecha_vencimiento: nuevaFechaVencimiento, ocupados: 0 };
                actualizarCuentasDisponibles();
                alert("Cuenta reemplazada correctamente");
                reemplazoCuenta.reset();
            });

            // Actualizar listas
            function actualizarCuentasDisponibles() {
                const select = document.getElementById("cuentasDisponibles");
                select.innerHTML = "";
                cuentas.forEach((cuenta, index) => {
                    const option = document.createElement("option");
                    option.value = index;
                    option.textContent = `${cuenta.correo} (${cuenta.perfiles - cuenta.ocupados} disponibles)`;
                    select.appendChild(option);
                });
            }

            function actualizarListaClientes() {
                listaClientes.innerHTML = "";
                clientes.forEach(cliente => {
                    const li = document.createElement("li");
                    li.textContent = `${cliente.nombreCliente} - ${cliente.whatsapp} (Cuenta: ${cliente.cuenta})`;
                    listaClientes.appendChild(li);
                });
            }
        });
    </script>
</body>
</html>
