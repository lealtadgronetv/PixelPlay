<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti칩n de Cuentas de Streaming</title>
    <!-- Importando correctamente Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Panel de Gesti칩n de Cuentas</h1>
    <button onclick="ingresarCuentaCompleta()">Ingresar Cuenta Completa</button>
    <button onclick="ingresarCuentaPerfil()">Ingresar Perfil</button>
    <button onclick="marcarPagada()">Marcar como Pagada</button>
    <button onclick="marcarVencida()">Marcar como Vencida</button>
    <button onclick="agregarDias()">Agregar D칤as</button>
    <button onclick="verCuentasDisponibles()">Ver Cuentas Disponibles</button>
    <button onclick="verPerfilesDisponibles()">Ver Perfiles Disponibles</button>
    <button onclick="liberarPerfiles()">Liberar Perfiles Vencidos</button>
    <button onclick="notificarSoporte()">Notificar Soporte</button>
    <button onclick="verTotalCuentas()">Ver Total de Cuentas</button>
    <button onclick="verTotalPerfiles()">Ver Total de Perfiles</button>

    <script>
    // 游댳 Configuraci칩n de Supabase
    const SUPABASE_URL = "https://vdsdtouiokgvzrscaroe.supabase.co";  // Reempl치zalo con tu URL
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZkc2R0b3Vpb2tndnpyc2Nhcm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEyMTU1NjQsImV4cCI6MjA1Njc5MTU2NH0.zZ_PsL3vXmNNaaWWu9yHGdYn7vfYhzH4jpAwyG9tJqA"; // Reempl치zalo con tu clave API
    const supabase = supabaseClient.createClient(SUPABASE_URL, SUPABASE_KEY);

    // 游댳 Ingresar una cuenta completa a Supabase
    async function ingresarCuentaCompleta() {
        let correo = prompt("Ingrese el correo de la nueva cuenta:");
        if (!correo) return alert("Correo inv치lido.");

        let { data, error } = await supabase.from("netflix").insert([
            { correo, perfiles_disponibles: 5, estado: "activa" }
        ]);

        if (error) {
            alert("Error al ingresar la cuenta.");
            console.error(error);
        } else {
            alert("Cuenta agregada correctamente.");
        }
    }

    // 游댳 Ingresar cuenta por perfil
    async function ingresarCuentaPerfil() {
        let cuentaID = prompt("Ingrese el ID de la cuenta:");
        if (!cuentaID) return alert("ID inv치lido.");

        let { data, error } = await supabase.from("netflix").select("*").eq("id", cuentaID).single();
        if (error || !data) return alert("Cuenta no encontrada.");

        if (data.perfiles_disponibles > 0) {
            let { error: updateError } = await supabase
                .from("netflix")
                .update({ perfiles_disponibles: data.perfiles_disponibles - 1 })
                .eq("id", cuentaID);

            if (updateError) {
                alert("Error al asignar perfil.");
                console.error(updateError);
            } else {
                alert("Perfil asignado correctamente.");
            }
        } else {
            alert("No hay perfiles disponibles.");
        }
    }

    // 游댳 Marcar cuenta como pagada
    async function marcarPagada() {
        let cuentaID = prompt("Ingrese el ID de la cuenta:");
        let { error } = await supabase.from("netflix").update({ estado_pago: "pagado" }).eq("id", cuentaID);
        error ? alert("Error al actualizar.") : alert("Cuenta marcada como pagada.");
    }

    // 游댳 Marcar cuenta como vencida
    async function marcarVencida() {
        let cuentaID = prompt("Ingrese el ID de la cuenta:");
        let { error } = await supabase.from("netflix").update({ estado: "vencida" }).eq("id", cuentaID);
        error ? alert("Error al actualizar.") : alert("Cuenta marcada como vencida.");
    }

    // 游댳 Agregar d칤as adicionales
    async function agregarDias() {
        let cuentaID = prompt("Ingrese el ID de la cuenta:");
        let dias = parseInt(prompt("Ingrese los d칤as adicionales:"), 10);
        if (isNaN(dias) || dias <= 0) return alert("D칤as inv치lidos.");

        let { data, error } = await supabase.from("netflix").select("dias_reposicion").eq("id", cuentaID).single();
        if (error || !data) return alert("Cuenta no encontrada.");

        let { error: updateError } = await supabase
            .from("netflix")
            .update({ dias_reposicion: data.dias_reposicion + dias })
            .eq("id", cuentaID);

        updateError ? alert("Error al actualizar.") : alert(`Se agregaron ${dias} d칤as.`);
    }

    // 游댳 Ver cuentas activas disponibles
    async function verCuentasDisponibles() {
        let { data, error } = await supabase.from("netflix").select("*").eq("estado", "activa");
        if (error) {
            alert("Error al obtener datos.");
        } else {
            alert(`Hay ${data.length} cuentas activas disponibles.`);
        }
    }

    // 游댳 Ver perfiles disponibles
    async function verPerfilesDisponibles() {
        let { data, error } = await supabase.from("netflix").select("perfiles_disponibles");
        if (error) {
            alert("Error al obtener datos.");
        } else {
            let totalPerfiles = data.reduce((sum, cuenta) => sum + cuenta.perfiles_disponibles, 0);
            alert(`Hay ${totalPerfiles} perfiles disponibles.`);
        }
    }

    // 游댳 Liberar perfiles vencidos
    async function liberarPerfiles() {
        let { error } = await supabase
            .from("netflix")
            .update({ perfiles_disponibles: 5 })
            .eq("estado", "vencida");

        error ? alert("Error al liberar perfiles.") : alert("Perfiles liberados correctamente.");
    }

    // 游댳 Notificar soporte de cuenta ca칤da
    async function notificarSoporte() {
        let cuentaID = prompt("Ingrese el ID de la cuenta ca칤da:");
        let motivo = prompt("Ingrese el motivo de la ca칤da:");
        if (!motivo) return alert("Debe ingresar un motivo.");

        let { error } = await supabase.from("netflix").update({ detalles_caida: motivo }).eq("id", cuentaID);
        error ? alert("Error al notificar soporte.") : alert("Soporte notificado.");
    }

    // 游댳 Ver total de cuentas registradas
    async function verTotalCuentas() {
        let { data, error } = await supabase.from("netflix").select("*");
        if (error) {
            alert("Error al obtener datos.");
        } else {
            alert(`Hay ${data.length} cuentas registradas.`);
        }
    }

    // 游댳 Ver total de perfiles en uso
    async function verTotalPerfiles() {
        let { data, error } = await supabase.from("netflix").select("perfiles_disponibles");
        if (error) {
            alert("Error al obtener datos.");
        } else {
            let totalUsados = data.reduce((sum, cuenta) => sum + (5 - cuenta.perfiles_disponibles), 0);
            alert(`Se han asignado ${totalUsados} perfiles en total.`);
        }
    }
    </script>
</body>
</html>
