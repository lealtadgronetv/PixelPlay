<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Cuentas Netflix</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>Gestión de Cuentas Netflix</h1>
    
    <h2>Agregar Cuenta Completa</h2>
    <form id="addAccountForm">
        <label for="correo">Correo:</label>
        <input type="email" id="correo" required>
        
        <label for="contraseña">Contraseña:</label>
        <input type="password" id="contraseña" required>
        
        <label for="plataforma">Plataforma:</label>
        <input type="text" id="plataforma" required>
        
        <label for="perfiles">Perfiles:</label>
        <input type="number" id="perfiles" required>
        
        <label for="fecha_vencimiento">Fecha de Vencimiento:</label>
        <input type="date" id="fecha_vencimiento" required>
        
        <label for="estado_pago">Estado de Pago:</label>
        <select id="estado_pago">
            <option value="pendiente">Pendiente</option>
            <option value="pagado">Pagado</option>
        </select>
        
        <label for="whatsapp_cliente">WhatsApp Cliente:</label>
        <input type="text" id="whatsapp_cliente">
        
        <button type="submit">Agregar Cuenta</button>
    </form>
    
    <h2>Filtrar Cuentas</h2>
    <input type="text" id="filterInput" placeholder="Filtrar por correo...">
    
    <h2>Lista de Cuentas</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Correo</th>
                <th>Plataforma</th>
                <th>Perfiles</th>
                <th>Fecha Vencimiento</th>
                <th>Estado de Pago</th>
                <th>WhatsApp Cliente</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="accountList"></tbody>
    </table>
    
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const supabaseUrl = 'https://vdsdtouiokgvzrscaroe.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZkc2R0b3Vpb2tndnpyc2Nhcm9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEyMTU1NjQsImV4cCI6MjA1Njc5MTU2NH0.zZ_PsL3vXmNNaaWWu9yHGdYn7vfYhzH4jpAwyG9tJqA';
        const supabase = createClient(supabaseUrl, supabaseKey);

        async function fetchAccounts() {
            const { data, error } = await supabase.from('netflix').select('*');
            if (error) console.error(error);
            else renderAccounts(data);
        }

        function renderAccounts(accounts) {
            const tableBody = document.getElementById('accountList');
            tableBody.innerHTML = '';
            accounts.forEach(account => {
                const row = `<tr>
                    <td>${account.id}</td>
                    <td>${account.correo}</td>
                    <td>${account.plataforma}</td>
                    <td>${account.perfiles}</td>
                    <td>${account.fecha_vencimiento}</td>
                    <td>${account.estado_pago}</td>
                    <td>${account.whatsapp_cliente || ''}</td>
                    <td><button onclick="deleteAccount(${account.id})">Eliminar</button></td>
                </tr>`;
                tableBody.innerHTML += row;
            });
        }

        async function addAccount(event) {
            event.preventDefault();
            const correo = document.getElementById('correo').value;
            const contraseña = document.getElementById('contraseña').value;
            const plataforma = document.getElementById('plataforma').value;
            const perfiles = document.getElementById('perfiles').value;
            const fecha_vencimiento = document.getElementById('fecha_vencimiento').value;
            const estado_pago = document.getElementById('estado_pago').value;
            const whatsapp_cliente = document.getElementById('whatsapp_cliente').value;
            
            await supabase.from('netflix').insert([{ 
                correo, 
                contraseña, 
                plataforma, 
                perfiles, 
                fecha_vencimiento, 
                estado_pago, 
                whatsapp_cliente
            }]);
            fetchAccounts();
        }

        async function deleteAccount(id) {
            await supabase.from('netflix').delete().eq('id', id);
            fetchAccounts();
        }

        document.getElementById('addAccountForm').addEventListener('submit', addAccount);
        document.getElementById('filterInput').addEventListener('input', (event) => {
            const filter = event.target.value.toLowerCase();
            document.querySelectorAll('#accountList tr').forEach(row => {
                row.style.display = row.cells[1].textContent.toLowerCase().includes(filter) ? '' : 'none';
            });
        });

        document.addEventListener('DOMContentLoaded', fetchAccounts);
    </script>
</body>
</html>
